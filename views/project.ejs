<%- include ('partials/notification') %>
    <div class="bg-lighten p-0 m-0 secNav">
        <% if(success_msg !='' ){ %>
            <div class="alert alert-warning alert-dismissible fade show" role="alert">
                <%= success_msg %>
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
            <% } %>
                <div class="container mainDiv" id="<%= login %>">
                    <div class=" row m-0 p-0">
                        <form id="save_Page" method="" action="" type="submit"
                            class="col-5 text-left align-self-center">
                            <button type="submit" class="btn btn-sm btn-outline-primary my-2 btnSavePage">SAVE</button>
                        </form>
                        <div class="col-2 text-center align-self-center">
                            <h4 class="text-primary my-2" id="<%= msg[0]._id %>">
                                <%= msg[0].name_board %>
                            </h4>
                        </div>
                        <div class="col-5">
                            <div class="row m-0 p-0 text-right">
                                <form type="submit" class="col my-2  align-self-center addUser">
                                    <input type="email" id="email" name="email"
                                        class="bg-outline-primary shareInput px-2 "> <i
                                        class="fas fa-search text-primary searchUser p-0 mx-0 px-0"
                                        id="searchUser"></i></input>
                                </form>
                                <div class="col my-2 mx-1 p-0 containerUsers">
                                    <% usersShare.forEach(user=>{ %>
                                        <div id="<%= user[2]%>" class="users my-1 p-0 text-center">
                                            <span class="cr p-1" title="<%= user[1] %>">
                                                <%= user[0] %>
                                            </span>
                                        </div>
                                        <%});%>
                                </div>
                                <div class="col my-2 p-0 containersAdminShare text-center">
                                    <div id="<%= msg[0].custumer_id[0]._id %>" class=" adminShare my-1 p-0">
                                        <span class="cr p-1" title="<%= msg[0].custumer_id[0].name %>">
                                            <%= msg[0].custumer_id[0].shortName %>
                                        </span>
                                    </div>
                                </div>
                                <form class="col my-2 align-self-center" id="back" method="get"
                                    action="/<%=name._id %>/dashboard" type="submit"
                                    class="my-2 col text-right mx-0 px-0">
                                    <button type="submit" class="btn p-0 mx-0 px-0" id="backicon"><i
                                            class="fas text-primary fa-sign-out-alt"></i></button>
                                </form>
                            </div>
                        </div>
                    </div>

                </div>
    </div>

    <div class="container mt-2">
        <div class="row m-0 p-0">
            <div class="col-3 bd-dash-left px-0 py-3 PLAN">
                <div class="col-12 text-center  py-2">
                    <h4 class='text-center d-flex justify-content-center  titleStick align-item-center '>
                        <span class="col-3">Plan</span>
                        <form action="" class="col-9 d-flex justify-content-center align-item-center ">
                            <button class="addnew text-center btn btn-sm btn-outline-primary" type="button"><i
                                    class="fas fa-plus-square mx-2"></i>add new</button>
                        </form>
                    </h4>
                </div>
                <div id="columnPLAN" class="column conectSortable columnPLAN px-4">
                    <% let obj=msg[0].plan; %>
                        <% if(obj){ %>
                            <% let keys=Object.keys(obj) %>
                                <% for(let i=0; i<keys.length; i++){ %>
                                    <% let value=obj[keys[i]]; %>
                                        <div id="<%= value.id %>" class="portlet m-0 my-3 card">
                                            <div class="portlet-header todo row m-0 p-0 bg-lighten ">
                                                <span id="exit" class="text-left col-2 ">x</span>
                                                <span id="toggleTasks"
                                                    class="toggleTasks text-right col-2 offset-8 ">-</span>
                                            </div>
                                            <div class="container cont">
                                                <div class="row m-0 p-3 card-header">
                                                    <h6 contenteditable="true"
                                                        class="title_task col-12 text-center p-2">
                                                        <%= value.name %>
                                                    </h6>
                                                </div>
                                            </div>
                                            <div id="taskArea" class="taskArea">
                                                <div class="container cont">
                                                    <% let keysTasks=Object.keys(value.data) %>
                                                        <% for(let i=0; i<keysTasks.length; i++){ %>
                                                            <% let valueTasks=value.data[keysTasks[i]]; %>
                                                                <% let check=keysTasks[i].split("_")[0] %>
                                                                    <% if(check=='title' ){ %>
                                                                        <div id="<%= valueTasks.id %>"
                                                                            contenteditable="true"
                                                                            class="m-0 p-2 textTitle gr">
                                                                            <%= valueTasks.value %>
                                                                        </div>
                                                                        <% }else if(check=='list' ){ %>
                                                                            <form id="<%= valueTasks.id %>"
                                                                                class="px-2 pb-2 m-0 gr form">
                                                                                <h6 contenteditable="true"
                                                                                    class="Lt text-center p-3">
                                                                                    <%= valueTasks.title %>
                                                                                </h6>
                                                                                <div class="containerListTask">
                                                                                    <div class="form-btns row m-0 p-0">
                                                                                        <div
                                                                                            class="inputBox col-10 px-1">
                                                                                            <input
                                                                                                class="inp col-12 p-0 m-0" />
                                                                                        </div>
                                                                                        <div
                                                                                            class="buttonBox col-2 px-1">
                                                                                            <button
                                                                                                class="addSubmit p-0 m-0 col-12 btn btn-danger">+</button>
                                                                                        </div>
                                                                                    </div>
                                                                                    <ul class="list  m-0 p-0">
                                                                                        <% let
                                                                                            key_ul=Object.keys(valueTasks.array)
                                                                                            %>
                                                                                            <% for(let i=0;
                                                                                                i<key_ul.length;i++){ %>
                                                                                                <% let
                                                                                                    valueli=valueTasks.array[key_ul[i]];
                                                                                                    %>
                                                                                                    <li
                                                                                                        class="row d-flex pr-2 align-items-center gr m-0 p-0 my-2">
                                                                                                        <div
                                                                                                            class="col-10 text-left p-0 m-0 textli text-break">
                                                                                                            <div contenteditable="true"
                                                                                                                class="col-12 m-0 p-0 pl-1 text-wrap">
                                                                                                                <%= valueli.value
                                                                                                                    %>
                                                                                                            </div>
                                                                                                        </div>
                                                                                                        <div
                                                                                                            class="col-1 d-flex align-items-center justify-content-end text-right checkBox p-0 m-0">
                                                                                                            <div
                                                                                                                class="form-check checkbox-warning-filled">
                                                                                                                <input
                                                                                                                    type="checkbox"
                                                                                                                    class="form-check-input filled-in"
                                                                                                                    id="defaultCheck"
                                                                                                                    <%
                                                                                                                    if
                                                                                                                    (valueli.checked){
                                                                                                                    %>
                                                                                                                <% if
                                                                                                                    (valueli.checked){
                                                                                                                    %>
                                                                                                                    <% let
                                                                                                                        check='checked'
                                                                                                                        %>
                                                                                                                        <%= check
                                                                                                                            %>
                                                                                                                            <% }
                                                                                                                                %>

                                                                                                                                <% }
                                                                                                                                    %>
                                                                                                                                    />
                                                                                                                                    <label
                                                                                                                                        class="form-check-label"
                                                                                                                                        for="defaultCheck"></label>
                                                                                                            </div>
                                                                                                        </div>
                                                                                                        <i class="col-1 m-0 p-0 far fa-trash-alt"
                                                                                                            id="deleteRow"></i>
                                                                                                    </li>
                                                                                                    <% } %>
                                                                                    </ul>
                                                                                </div>
                                                                            </form>
                                                                            <% } %>
                                                                                <% } %>
                                                </div>
                                                <div class="portlet-content bg-lighten">
                                                    <div class="menuBox row m-0 p-0 px-1">
                                                        <i class="addnewchecklsit col-2 fas fa-list p-2 m-0 mx-1"></i>
                                                        <i class="addText col-2 fas fa-heading p-2 m-0 mx-1"></i>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <% } %>
                                            <% } %>
                </div>
            </div>

            <div class="col-3 bd-dash-left px-0 py-3  TODO">
                <h4 class='text-center py-2 d-flex justify-content-center titleStick align-item-center'>
                    <span class="badge bg-danger to_do">
                        <% let objtodo=msg[0].todo; %>
                            <% if(objtodo){ %>
                                <% let keystodo=Object.keys(objtodo) %>
                                    <%= keystodo.length %>
                                        <% }else{%>
                                            <%= 0 %>
                                                <% } %>
                    </span>
                    <span class="mx-2">
                        To Do
                    </span>
                </h4>
                <div id="columnTODO" class="column conectSortable  columnTODO px-4">
                    <% if(objtodo){ %>
                        <% let keystodo=Object.keys(objtodo) %>
                            <% for(let i=0; i<keystodo.length; i++){ %>
                                <% let value=objtodo[keystodo[i]]; %>
                                    <div id="<%=  value.id %>" class="portlet m-0 my-3 card">
                                        <div class="portlet-header todo row m-0 p-0 bg-lighten ">
                                            <span id="exit" class="text-left col-2 ">x</span>
                                            <span id="toggleTasks"
                                                class="toggleTasks text-right col-2 offset-8 ">-</span>
                                        </div>
                                        <div class="container cont">
                                            <div class="row m-0 p-3 card-header">
                                                <h6 contenteditable="true" class="title_task col-12 text-center p-2">
                                                    <%= value.name %>
                                                </h6>
                                            </div>
                                        </div>
                                        <div id="taskArea" class="taskArea">
                                            <div class="container cont">
                                                <% let keysTasks=Object.keys(value.data) %>
                                                    <% for(let i=0; i<keysTasks.length; i++){ %>
                                                        <% let valueTasks=value.data[keysTasks[i]]; %>
                                                            <% let check=keysTasks[i].split("_")[0] %>
                                                                <% if(check=='title' ){ %>
                                                                    <div id="<%= valueTasks.id %>"
                                                                        contenteditable="true"
                                                                        class="m-0 p-2 textTitle gr">
                                                                        <%= valueTasks.value %>
                                                                    </div>
                                                                    <% }else if(check=='list' ){ %>
                                                                        <form id="<%= valueTasks.id %>"
                                                                            class="px-2 pb-2 m-0 gr form">
                                                                            <h6 contenteditable="true"
                                                                                class="Lt text-center p-3">
                                                                                <%= valueTasks.title %>
                                                                            </h6>
                                                                            <div class="containerListTask">
                                                                                <div class="form-btns row m-0 p-0">
                                                                                    <div class="inputBox col-10 px-1">
                                                                                        <input
                                                                                            class="inp col-12 p-0 m-0" />
                                                                                    </div>
                                                                                    <div class="buttonBox col-2 px-1">
                                                                                        <button
                                                                                            class="addSubmit p-0 m-0 col-12 btn btn-danger">+</button>
                                                                                    </div>
                                                                                </div>
                                                                                <ul class="list  m-0 p-0">
                                                                                    <% let
                                                                                        key_ul=Object.keys(valueTasks.array)
                                                                                        %>
                                                                                        <% for(let i=0;
                                                                                            i<key_ul.length;i++){ %>
                                                                                            <% let
                                                                                                valueli=valueTasks.array[key_ul[i]];
                                                                                                %>
                                                                                                <li
                                                                                                    class="row d-flex pr-2 align-items-center gr m-0 p-0 my-2">
                                                                                                    <div
                                                                                                        class="col-10 text-left p-0 m-0 textli text-break">
                                                                                                        <div contenteditable="true"
                                                                                                            class="col-12 m-0 p-0 pl-1 text-wrap">
                                                                                                            <%= valueli.value
                                                                                                                %>
                                                                                                        </div>
                                                                                                    </div>
                                                                                                    <div
                                                                                                        class="col-1 d-flex align-items-center justify-content-end text-right checkBox p-0 m-0">
                                                                                                        <div
                                                                                                            class="form-check checkbox-warning-filled">
                                                                                                            <input
                                                                                                                type="checkbox"
                                                                                                                class="form-check-input filled-in"
                                                                                                                id="defaultCheck"
                                                                                                                <% if
                                                                                                                (valueli.checked){
                                                                                                                %>
                                                                                                            <% let
                                                                                                                check='checked'
                                                                                                                %>
                                                                                                                <%= check
                                                                                                                    %>
                                                                                                                    <% }
                                                                                                                        %>
                                                                                                                        />
                                                                                                                        <label
                                                                                                                            class="form-check-label"
                                                                                                                            for="defaultCheck"></label>
                                                                                                        </div>
                                                                                                    </div>
                                                                                                    <i class="col-1 m-0 p-0 far fa-trash-alt"
                                                                                                        id="deleteRow"></i>
                                                                                                </li>
                                                                                                <% } %>
                                                                                </ul>
                                                                            </div>
                                                                        </form>
                                                                        <% } %>
                                                                            <% } %>
                                            </div>
                                            <div class="portlet-content bg-lighten">
                                                <div class="menuBox row m-0 p-0 px-1">
                                                    <i class="addnewchecklsit col-2 fas fa-list p-2 m-0 mx-1"></i>
                                                    <i class="addText col-2 fas fa-heading p-2 m-0 mx-1"></i>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <% } %>
                                        <% } %>
                </div>
            </div>

            <div class="col-3 bd-dash-left px-0 py-3 DOING">
                <h4 class='text-center py-2 d-flex justify-content-center titleStick align-item-center'>
                    <span id="max" class="badge bg-lighten m-0 p-0 mx-2"><input type="number" placeholder="3"
                            value="<%= msg[0].max_doing  %>" class="maxinp">
                        max</span>
                    <span class="badge bg-yellow doing">
                        <% let objdoing=msg[0].doing; %>
                            <% if(objdoing){ %>
                                <% let keysdoing=Object.keys(objdoing) %>
                                    <%= keysdoing.length %>
                                        <% }else{%>
                                            <%= 0 %>
                                                <% } %>

                    </span>
                    <span class="mx-2">
                        Doing
                    </span>
                </h4>
                <div id="columnDOING" class="column conectSortable columnDOING px-4">
                    <% if(objdoing){ %>
                        <% let keysdoing=Object.keys(objdoing) %>
                            <% for(let i=0; i<keysdoing.length; i++){ %>
                                <% let value=objdoing[keysdoing[i]]; %>
                                    <div id="<%= value.id %>" class="portlet m-0 my-3 card">
                                        <div class="portlet-header todo row m-0 p-0 bg-lighten ">
                                            <span id="exit" class="text-left col-2 ">x</span>
                                            <span id="toggleTasks"
                                                class="toggleTasks text-right col-2 offset-8 ">-</span>
                                        </div>
                                        <div class="container cont">
                                            <div class="row m-0 p-3 card-header">
                                                <h6 contenteditable="true" class="title_task col-12 text-center p-2">
                                                    <%= value.name %>
                                                </h6>
                                            </div>
                                        </div>
                                        <div id="taskArea" class="taskArea">
                                            <div class="container cont">
                                                <% let keysTasks=Object.keys(value.data) %>
                                                    <% for(let i=0; i<keysTasks.length; i++){ %>
                                                        <% let valueTasks=value.data[keysTasks[i]]; %>
                                                            <% let check=keysTasks[i].split("_")[0] %>
                                                                <% if(check=='title' ){ %>
                                                                    <div id="<%= valueTasks.id %>"
                                                                        contenteditable="true"
                                                                        class="m-0 p-2 textTitle gr">
                                                                        <%= valueTasks.value %>
                                                                    </div>
                                                                    <% }else if(check=='list' ){ %>
                                                                        <form id="<%= valueTasks.id %>"
                                                                            class="px-2 pb-2 m-0 gr form">
                                                                            <h6 contenteditable="true"
                                                                                class="Lt text-center p-3">
                                                                                <%= valueTasks.title %>
                                                                            </h6>

                                                                            <div class="containerListTask">
                                                                                <div class="form-btns row m-0 p-0">
                                                                                    <div class="inputBox col-10 px-1">
                                                                                        <input
                                                                                            class="inp col-12 p-0 m-0" />
                                                                                    </div>
                                                                                    <div class="buttonBox col-2 px-1">
                                                                                        <button
                                                                                            class="addSubmit p-0 m-0 col-12 btn btn-danger">+</button>
                                                                                    </div>
                                                                                </div>
                                                                                <ul class="list  m-0 p-0">
                                                                                    <% let
                                                                                        key_ul=Object.keys(valueTasks.array)
                                                                                        %>
                                                                                        <% for(let i=0;
                                                                                            i<key_ul.length;i++){ %>
                                                                                            <% let
                                                                                                valueli=valueTasks.array[key_ul[i]];
                                                                                                %>
                                                                                                <li
                                                                                                    class="row d-flex pr-2 align-items-center gr m-0 p-0 my-2">
                                                                                                    <div
                                                                                                        class="col-10 text-left p-0 m-0 textli text-break">
                                                                                                        <div contenteditable="true"
                                                                                                            class="col-12 m-0 p-0 pl-1 text-wrap">
                                                                                                            <%= valueli.value
                                                                                                                %>
                                                                                                        </div>
                                                                                                    </div>
                                                                                                    <div
                                                                                                        class="col-1 d-flex align-items-center justify-content-end text-right checkBox p-0 m-0">
                                                                                                        <div
                                                                                                            class="form-check checkbox-warning-filled">
                                                                                                            <input
                                                                                                                type="checkbox"
                                                                                                                class="form-check-input filled-in"
                                                                                                                id="defaultCheck"
                                                                                                                <% if
                                                                                                                (valueli.checked){
                                                                                                                %>
                                                                                                            <% let
                                                                                                                check='checked'
                                                                                                                %>
                                                                                                                <%= check
                                                                                                                    %>
                                                                                                                    <% }
                                                                                                                        %>
                                                                                                                        />
                                                                                                                        <label
                                                                                                                            class="form-check-label"
                                                                                                                            for="defaultCheck"></label>
                                                                                                        </div>
                                                                                                    </div>
                                                                                                    <i class="col-1 m-0 p-0 far fa-trash-alt"
                                                                                                        id="deleteRow"></i>
                                                                                                </li>
                                                                                                <% } %>
                                                                                </ul>
                                                                            </div>
                                                                        </form>
                                                                        <% } %>
                                                                            <% } %>
                                            </div>
                                            <div class="portlet-content bg-lighten">
                                                <div class="menuBox row m-0 p-0 px-1">
                                                    <i class="addnewchecklsit col-2 fas fa-list p-2 m-0 mx-1"></i>
                                                    <i class="addText col-2 fas fa-heading p-2 m-0 mx-1"></i>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <% } %>
                                        <% } %>
                </div>
            </div>

            <div class="col-3 bd-dash px-0 py-3 DONE">
                <h4 class='py-2 d-flex justify-content-center titleStick align-item-center'><span
                        class=" badge bg-success done">
                        <% let objDone=msg[0].done; %>
                            <% if(objDone){ %>
                                <% let keysdone=Object.keys(objDone) %>
                                    <%= keysdone.length %>
                                        <% }else{%>
                                            <%= 0 %>
                                                <% } %>
                    </span>
                    <span class="mx-2">
                        Done
                    </span>
                </h4>
                <div id="columnDONE" class="column conectSortable columnDONE px-4">
                    <% if(objDone){ %>
                        <% let keysdone=Object.keys(objDone) %>
                            <% for(let i=0; i<keysdone.length; i++){ %>
                                <% let value=objDone[keysdone[i]]; %>
                                    <div id="<%= value.id %>" class="portlet m-0 my-3 card">
                                        <div class="portlet-header todo row m-0 p-0 bg-lighten ">
                                            <span id="exit" class="text-left col-2 ">x</span>
                                            <span id="toggleTasks"
                                                class="toggleTasks text-right col-2 offset-8">-</span>
                                        </div>
                                        <div class="container cont">
                                            <div class="row m-0 p-3 card-header">
                                                <h6 contenteditable="true" class="title_task col-12 text-center p-2">
                                                    <%= value.name %>
                                                </h6>
                                            </div>
                                        </div>
                                        <div id="taskArea" class="taskArea">
                                            <div class="container cont">
                                                <% let keysTasks=Object.keys(value.data) %>
                                                    <% for(let i=0; i<keysTasks.length; i++){ %>
                                                        <% let valueTasks=value.data[keysTasks[i]]; %>
                                                            <% let check=keysTasks[i].split("_")[0] %>
                                                                <% if(check=='title' ){ %>
                                                                    <div id="<%= valueTasks.id %>"
                                                                        contenteditable="true"
                                                                        class="m-0 p-2 textTitle gr">
                                                                        <%= valueTasks.value %>
                                                                    </div>
                                                                    <% }else if(check=='list' ){ %>
                                                                        <form id="<%= valueTasks.id %>"
                                                                            class="px-2 pb-2 m-0 gr form">
                                                                            <h6 contenteditable="true"
                                                                                class="Lt text-center p-3">
                                                                                <%= valueTasks.title %>
                                                                            </h6>
                                                                            <div class="containerListTask">
                                                                                <div class="form-btns row m-0 p-0">
                                                                                    <div class="inputBox col-10 px-1">
                                                                                        <input
                                                                                            class="inp col-12 p-0 m-0" />
                                                                                    </div>
                                                                                    <div class="buttonBox col-2 px-1">
                                                                                        <button
                                                                                            class="addSubmit p-0 m-0 col-12 btn btn-danger">+</button>
                                                                                    </div>
                                                                                </div>
                                                                                <ul class="list  m-0 p-0">
                                                                                    <% let
                                                                                        key_ul=Object.keys(valueTasks.array)
                                                                                        %>
                                                                                        <% for(let i=0;
                                                                                            i<key_ul.length;i++){ %>
                                                                                            <% let
                                                                                                valueli=valueTasks.array[key_ul[i]];
                                                                                                %>
                                                                                                <li
                                                                                                    class="row d-flex pr-2 align-items-center gr m-0 p-0 my-2">
                                                                                                    <div
                                                                                                        class="col-10 text-left p-0 m-0 textli text-break">
                                                                                                        <div contenteditable="true"
                                                                                                            class="col-12 m-0 p-0 pl-1 text-wrap">
                                                                                                            <%= valueli.value
                                                                                                                %>
                                                                                                        </div>
                                                                                                    </div>
                                                                                                    <div
                                                                                                        class="col-1 d-flex align-items-center justify-content-end text-right checkBox p-0 m-0">
                                                                                                        <div
                                                                                                            class="form-check checkbox-warning-filled">
                                                                                                            <input
                                                                                                                type="checkbox"
                                                                                                                class="form-check-input filled-in"
                                                                                                                id="defaultCheck"
                                                                                                                <%
                                                                                                                if(valueli.checked){%>
                                                                                                            <% let
                                                                                                                check='checked'
                                                                                                                %>
                                                                                                                <%=
                                                                                                                    check%>
                                                                                                                    <% }
                                                                                                                        %>
                                                                                                                        />
                                                                                                                        <label
                                                                                                                            class="form-check-label"
                                                                                                                            for="defaultCheck"></label>
                                                                                                        </div>
                                                                                                    </div>
                                                                                                    <i class="col-1 m-0 p-0 far fa-trash-alt"
                                                                                                        id="deleteRow"></i>
                                                                                                </li>
                                                                                                <% } %>
                                                                                </ul>
                                                                            </div>
                                                                        </form>
                                                                        <% } %>
                                                                            <% } %>
                                            </div>
                                            <div class="portlet-content bg-lighten">
                                                <div class="menuBox row m-0 p-0 px-1">
                                                    <i class="addnewchecklsit col-2 fas fa-list p-2 m-0 mx-1"></i>
                                                    <i class="addText col-2 fas fa-heading p-2 m-0 mx-1"></i>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <% } %>
                                        <% } %>
                </div>
            </div>
        </div>
    </div>

    <script src='/js/board.js'></script>